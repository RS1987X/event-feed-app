version: 1
defaults:
  min_amount_ccy: SEK
  company_tier_weights: { "mega": 1.0, "large": 0.8, "mid": 0.6, "small": 0.4 }
  source_weights: { "exchange": 1.0, "issuer_pr": 0.8, "regulator": 1.0, "wire": 0.6 }

events:
  - key: guidance_change
    label: Guidance change for company or competitor

    thresholds:
      withdraw_or_suspend: always
      initiate_new_period: always
      delta_pct_level_min: 5
      delta_pp_growth_min: 3
      delta_pp_margin_min: 1.5
      label_delta_pct_level_min: 2
      label_delta_pp_growth_min: 1.0
      label_delta_pp_margin_min: 0.3
      approx_band_pp_margin: 0.5
      approx_band_pp_growth: 1.0

      # === Proximity engine tuning ===
      proximity:
        mode: "token"
        fwd_cue_metric_chars: 120
        fwd_cue_metric_tokens: 10
        allow_cross_sentence: false
        look_left_sentences: 0
        look_right_sentences: 0

      # was: negations_en / negations_sv
      unchanged_markers_en: ["unchang", "in line", "no change", "as previously", "as prior"]
      unchanged_markers_sv: ["oföränd", "i linje med", "som tidigare"]

    patterns:
      triggers:
        # Keep only high-precision, canonical phrase regexes here.
        en_any:
          - '\bprofit\s+(warning|alert)s?\b'
          - '\b(?:write[ -]?down|write[ -]?off|impairment(?:\s+charge)?s?)\b'
        sv_any:
          - '\bomvänd\s+vinstvarning\b|\bvinstvarning\b'
          - '\b(nedskrivning(ar)?|nedskrivnings(post|kostnad)(er)?|engångsnedskrivning(ar)?|nedskrivningsbehov)\b'

      # Forward-looking cues (unchanged; used elsewhere)
      fwd_cue:
        terms:
          en: [expect, expects, project, projects, aim, target, targets, anticipate, plan, intend, will, should, "we see", "we believe", "we expect"]
          sv: [förväntar, "räknar med", siktar, målsätter, planerar, avser, "kommer att", bör, "vi ser", "vi tror"]

      # === NEW: token proximity rules for guidance ===
      proximity_triggers:
        - name: en_guidance_change
          type: guidance_change
          lang: en
          verbs: [raise, raises, raised, raising,
                  lower, lowers, lowered, lowering,
                  revise, revises, revised, revising,
                  update, updates, updated, updating,
                  withdraw, withdraws, withdrew, withdrawn,
                  suspend, suspends, suspended, suspending,
                  narrow, narrows, narrowed, narrowing,
                  tighten, tightens, tightened, tightening,
                  widen, widens, widened, widening]
          metrics: ["guidance","guidance range","outlook","forecast",
                    "full year guidance","full-year guidance","fy guidance"]
          window_tokens: 10
          same_sentence: true
         
        #unchanged / reaffirm (verbs)
        - name: en_guidance_unchanged_verbal
          type: guidance_unchanged
          lang: en
          verbs: [reaffirm, reaffirms, reaffirmed, reaffirming,
                  maintain, maintains, maintained, maintaining,
                  keep, keeps, kept, keeping,
                  leave, leaves, left, leaving]
          metrics: ["guidance","outlook","forecast","full-year guidance","fy guidance"]
          window_tokens: 10
          same_sentence: true

        - name: sv_guidance_unchanged_verbal
          type: guidance_unchanged
          lang: sv
          verbs: ["bekräftar","lämnar","vidhåller"]
          metrics: ["prognos","prognosen","utsikter","utsikterna","guidning","helårsprognos"]
          window_tokens: 10
          same_sentence: true

        - name: en_guidance_unchanged_token
          type: guidance_unchanged
          lang: en
          metrics: ["guidance","outlook","forecast","full-year guidance","fy guidance"]
          unchanged_tokens: "@unchanged_markers_en"   # resolve from thresholds.proximity
          window_tokens: 6
          same_sentence: true

        - name: sv_guidance_unchanged_token
          type: guidance_unchanged
          lang: sv
          metrics: ["prognos","prognosen","utsikter","utsikterna","guidning","helårsprognos"]
          unchanged_tokens: "@unchanged_markers_sv"
          window_tokens: 6
          same_sentence: true

            # Optional: allow "increase" but only with a very tight window.
        - name: en_increase_guidance
          type: guidance_change
          lang: en
          verbs: [increase, increases, increased, increasing]
          metrics: ["guidance","outlook","forecast"]
          window_tokens: 4
          same_sentence: true

        - name: sv_guidance_change
          type: guidance_change
          lang: sv
          verbs: ["höjer","höjde","höjs",
                  "sänker","sänkte","sänks",
                  "reviderar","reviderades",
                  "uppdaterar","uppdaterades",
                  "återkallar","drar tillbaka",
                  "suspenderar"]
          metrics: ["prognos","prognosen","utsikter","utsikterna","guidning","helårsprognos"]
          window_tokens: 10
          same_sentence: true
          
        - name: en_guidance_initiate
          type: guidance_initiate
          lang: en
          verbs: [initiate, initiates, initiated, initiating,
                  provide, provides, provided, providing,
                  issue, issues, issued, issuing,
                  set, sets, set, setting,
                  introduce, introduces, introduced, introducing,
                  publish, publishes, published, publishing,
                  present, presents, presented, presenting]
          metrics: ["guidance","outlook","forecast","full-year guidance","fy guidance"]
          window_tokens: 10
          same_sentence: true
          require_period_token: true

        - name: sv_guidance_initiate
          type: guidance_initiate
          lang: sv
          verbs: ["initierar","lämnar","tillhandahåller","utfärdar","sätter","introducerar","publicerar","presenterar"]
          metrics: ["prognos","utsikter","guidning","helårsprognos"]
          window_tokens: 10
          same_sentence: true
          require_period_token: true


      # numbers-near-metric (statement lines w/out direction)
      metric_numeric_triggers:
        - name: en_guidance_numeric
          type: guidance_stated
          lang: en
          metrics: ["guidance","guidance range","outlook","forecast","full-year guidance","fy guidance"]
          window_tokens: 8
          same_sentence: true
          require_number: true

        - name: sv_guidance_numeric
          type: guidance_stated
          lang: sv
          metrics: ["prognos","prognosen","utsikter","utsikterna","guidning","helårsprognos"]
          window_tokens: 8
          same_sentence: true
          require_number: true
        

      # Directional language (kept; minor tidy)
      dir_up:
        any:
          - '\b(improv\w+|increase\w*|expand\w*|grow\w*|strengthen\w*|better)\b'
          - '\b(förbättra\w*|öka\w*|stärk\w*|bättre)\b'
      dir_dn:
        any:
          - '\b(declin\w+|decreas\w+|contract\w*|pressure|pressures|headwind\w*|worse)\b'
          - '\b(försämr\w*|minsk\w*|press|motvind\w*|sämre)\b'

      invite:
        any:
          - '\b(invite|invitation|invites|inbjudan|webcast|conference\s+call|earnings\s+call|teleconference|presentation|fireside\s+chat|reminder|save\s+the\s+date)\b'

      disclaimer_block:
        any:
          - '(forward[-\s]looking\s+statements|safe\s+harbor|cautionary\s+statement|legal\s+disclaimer|risk\s+factors|note\s+regarding\s+forward[-\s]looking)'

      disclaimer_inline:
        any:
          - '(statements?\s+that\s+are\s+not\s+historical|subject\s+to\s+risks\s+and\s+uncertainties|actual\s+results\s+may\s+differ\s+materially)'

      suppressors:
        analyst:
          any:
            - '\banalyst(s)?\b|\bconsensus\b|\bBloomberg\b|\bFactSet\b|\bInfront\b|\bRefinitiv(e)?\b'
        macro:
          any:
            - '\b(market|industry|sector|bransch|marknaden|industrin)\b'
        ma:
          any:
            - '\b(acquir(e|es|ed|ing)|acquisition|purchase price|consideration|enterprise value|EV|offer|bid|tender|förvärv|köpeskilling|vederlag|bud)\b'
        debt:
          any:
            - '\b(notes?|coupon|bond|loan|interest|facility|revolver|obligation|kupong|ränta|lån|kreditfacilitet)\b'

    # Optional term lists used elsewhere (unchanged aside from tiny additions)
    terms:
      margin_allowed_prefixes: [operating, "op.", EBIT, EBITDA, EBITA, rörelse, ebit, ebitda, ebita]
      dir_up_terms: [improve, improving, increase, increasing, expand, grow, strengthen, better,
                     förbättra, förbättras, öka, ökande, stärka, bättre]
      dir_dn_terms: [decline, declining, decrease, decreasing, contract, pressure, headwinds, worse,
                     försämra, försämras, minska, minskande, press, motvind, sämre]


  - key: equity_raise
    label: Equity raise
    thresholds:
      amount_ccy: 50000000         # >= 50M SEK
    patterns:
      any: ["företrädesemission", "riktad emission", "new share issue", "private placement", "prospekt"]
    score:
      base: 0.65
      features: ["amount_log", "source_weight", "novelty_30d"]

  - key: ceo_change
    label: CEO change
    thresholds: {}
    patterns:
      any: ["CEO", "vd", "verkställande direktör", "chief executive"]
    score:
      base: 0.6
      features: ["source_weight", "company_tier"]

  - key: regulatory_approval
    label: Regulatory approval/clearance/refusal
    thresholds: {}
    patterns:
      any: ["approved", "clearance", "godkänd", "CE mark", "CRL", "refusal", "återkallelse", "recall"]
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: breaking_bond_covenants
    label: Breaking of bond covenants or loan agreements
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  
  - key: regulatory_resulution
    label: Investigations are closed with resolution (fine, warning, no action)
    thresholds: {}
    patterns:
      any: ["approved", "clearance", "godkänd", "CE mark", "CRL", "refusal", "återkallelse", "recall"]
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]


  - key: phase_3_clinical_trial_results
    label: Phase 3 clinical trial results
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: last_day_trading_of_rights
    label: Last day that rights are traded in rights issue, if stock was preassured from rights selling
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: incentive_program_expiration_upcoming
    label: Incentive programs expiring in next 3 months can lead to positive (possibly negative) communication
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: supplier_shortage
    label: Shortage at a supplier might lead to supply chain issues
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: distributor_inventory_build
    label: Inventory build up at distributor might lead to future sales drop
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]
            
  - key: major_product_recall
    label: companies recalling a major product might increase cost and drop sales and also lawsuits
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]
  
  - key: factory_shutdown
    label: Shutdown of capacity from accidents or other reasons leads might lead to supply issues
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: top_tier_partnerships
    label: Unproven company/product recognition by a top tier partnership
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]
  
  - key: major_order_win
    label: Major order win from established top tier customer
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]
      
  - key: competitor_tender_offer
    label: A competitor recieves tender offer for entire business
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: lawsuit_filed
    label: A regulator starts investigation or a lawsuit is filed against the company
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: large_share_buyback_program
    label: A large share buyback program might support the share price. Needs to be a fresh initiation or an acceleration.
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]

  - key: tending_period_expires
    label: Tendering period expires might be higher risk for the share if not 90% is reached
    thresholds: {}
    patterns:
      any: []
    score:
      base: 0.7
      features: ["source_weight", "corroboration_count"]
